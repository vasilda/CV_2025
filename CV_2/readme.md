
# Лабораторная работа №2. Реализация трекинга объекта на видео

---

## Теоретическая база

Трекинг заключается в восстановлении положения одного и того же объекта на последовательности кадров.  
В данной реализации используется комбинация методов:

- **AKAZE** — детекция и описание ключевых точек для инициализации и восстановления трекинга при потере;
- **Lucas–Kanade (LK)** — оптический поток для отслеживания ключевых точек кадр к кадру;
- **Гомография + RANSAC** — для оценки положения объекта и фильтрации выбросов.

Корректная работа алгоритма основывается на следующих предположениях:

- объект содержит достаточное количество текстурных элементов для детекции ключевых точек;
- перемещение объекта между соседними кадрами умеренное;
- качество видео позволяет надежно вычислять оптический поток.

---

### Детекция и сопоставление ключевых точек (AKAZE)

- AKAZE извлекает **ключевые точки и дескрипторы**, устойчивые к поворотам и масштабированию;
- Сопоставление дескрипторов выполняется с помощью **BFMatcher** с нормой Хэмминга;
- Для фильтрации выбросов применяется **Lowe’s ratio test**;
- Минимальное количество точек для построения гомографии: **8**.

---

### Оптический поток (Lucas–Kanade)

- Используется для отслеживания точек кадр к кадру внутри области интереса (ROI);
- Применяется **пирамидальная версия** метода для работы с более крупными перемещениями;
- Фильтруются точки с низким качеством отслеживания;
- Для построения гомографии учитываются только точки, прошедшие проверку на inliers (**минимум 15 точек**).

---

### Визуализация положения объекта

- **Bounding Box** строится по текущим позициям точек или по гомографии;
- Статус трекинга отображается как `TRACKING` (зелёный) или `LOST` (красный);
- Также показывается номер кадра и количество отслеживаемых точек.

---

## Описание разработанной системы

### Структура проекта
```
├── object_tracking.ipynb # основной файл программы
├── test_videos/ # тестовые видеоролики
├── result_videos/ # результаты трекинга
└── README.md # описание работы
```
---

### Алгоритм работы

1. Загрузка видео и чтение первого кадра.
2. Автоматическая инициализация ROI — весь первый кадр.
3. Детекция ключевых точек для Lucas–Kanade (`goodFeaturesToTrack`) внутри ROI.
4. Для каждого последующего кадра:
   - Если трекинг потерян:
     - Детекция AKAZE на текущем кадре;
     - Восстановление положения объекта через гомографию;
     - Повторная инициализация точек LK.
   - Иначе:
     - Вычисление оптического потока Lucas–Kanade;
     - Фильтрация успешно отслеженных точек;
     - Обновление положения объекта через гомографию;
   - Визуализация результатов (BBox, статус, количество точек, кадр).
5. Подсчет статистики: количество обработанных кадров, трекинг, потери, попытки восстановления и успешные восстановления.

---

## Параметры реализации

- **Детектор ключевых точек:** Первичные точки LK: goodFeaturesToTrack; AKAZE используется для восстановления трекинга  
- **Максимальное число точек LK:** 500  
- **Порог качества для LK:** 0.01  
- **Минимальное расстояние между точками:** 7 px  
- **Размер блока для LK:** 7×7  
- **Lucas–Kanade:** `winSize=(21,21)`, `maxLevel=3`, `criteria=(30, 0.01)`  
- **Минимум inliers для LK:** 15  
- **Минимум inliers для AKAZE:** 8  

---

## Экспериментальная часть

### Используемые данные

- Тестовые видеоролики из папки `test_videos/`;
- Видеозапись с объектом схожей структуры, сделанная самостоятельно.

---

### Наблюдения

- Алгоритм устойчив при умеренном движении объекта;
- Bounding Box корректно показывает область объекта при размытии;
- Гомография обеспечивает более точное позиционирование при хорошем качестве видео;
- Потеря трекинга возможна при резких движениях или сильных окклюзиях;
- Восстановление трекинга через AKAZE эффективно при частичной потере точек.

---

## Выводы

- Реализован прототип системы трекинга объекта на видео с использованием AKAZE и Lucas–Kanade;
- Алгоритм корректно отслеживает объекты с выраженной текстурой;
- Демонстрируется устойчивость к масштабированию и поворотам;
- Позволяет визуально оценивать качество трекинга;
- Ограничения метода связаны с качеством видео и допущениями оптического потока.

---



