
# Лабораторная работа №2. Реализация трекинга объекта на видео

---

## Теоретическая база

Трекинг заключается в восстановлении положения одного и того же объекта на последовательности кадров.  
В данной реализации используется комбинация методов:

- **Lucas–Kanade (LK)** — оптический поток для отслеживания ключевых точек кадр к кадру;
- **AKAZE** — детекция и описание ключевых точек для восстановления трекинга при потере;
- **Гомография + RANSAC** — для оценки положения объекта и фильтрации выбросов.

Корректная работа алгоритма основывается на следующих предположениях:

- объект содержит достаточное количество текстурных элементов для детекции ключевых точек;
- перемещение объекта между соседними кадрами умеренное;
- качество видео позволяет надежно вычислять оптический поток.
---

### Оптический поток (Lucas–Kanade)

- Используется для отслеживания точек кадр к кадру внутри области интереса;
- Начальные точки инициализируются с помощью метода goodFeaturesToTrack;
- Применяется пирамидальная версия метода для работы с более крупными перемещениями;
- Фильтруются точки с низким качеством отслеживания;
- Для построения гомографии учитываются только точки, прошедшие проверку на inliers (минимум 15 точек).
---

### Детекция и сопоставление ключевых точек (AKAZE)

- AKAZE извлекает ключевые точки и дескрипторы, устойчивые к поворотам и масштабированию, для восстановления трекинга;
- Сопоставление дескрипторов выполняется с помощью BFMatcher с нормой Хэмминга;
- Для фильтрации выбросов применяется Lowe’s ratio test.

---

### Визуализация положения объекта

- Bounding Box строится по текущим позициям точек или по гомографии;
- Статус трекинга отображается как `TRACKING` (зелёный) или `LOST` (красный);
- Также показывается номер кадра и количество отслеживаемых точек.

---

## Описание разработанной системы

### Структура проекта
```
├── object_tracking.ipynb # основной файл программы
├── test_videos/ # тестовые видеоролики
├── result_videos/ # результаты трекинга
└── README.md # описание работы
```
---

### Алгоритм работы

### Алгоритм работы

1. Загрузка видео и чтение первого кадра.
2. Преобразование первого кадра в оттенки серого.
3. Автоматическая инициализация ключевых точек для Lucas–Kanade:
   - на первом кадре детектируются точки с помощью `goodFeaturesToTrack`
     по всему изображению;
   - полученные точки используются как начальные для оптического потока.
4. Автоматическая инициализация области интереса (ROI):
   - по координатам найденных точек LK строится минимальная
     ограничивающая прямоугольная рамка (Bounding Box);
   - рамка задаётся четырьмя угловыми точками и используется как
     начальное положение объекта.
5. Детекция ключевых точек и дескрипторов AKAZE на первом кадре для восстановления трекинга.
6. Для каждого последующего кадра:
   - преобразование кадра в оттенки серого;
   - если трекинг **активен**:
     - вычисление оптического потока Lucas–Kanade для всех текущих точек;
     - отбор успешно отслеженных точек;
     - оценка гомографии между соседними кадрами с помощью RANSAC;
     - обновление положения рамки объекта по найденной гомографии;
   - если трекинг **потерян**:
     - детекция ключевых точек AKAZE на текущем кадре;
     - сопоставление дескрипторов с первым кадром;
     - восстановление положения объекта через гомографию и RANSAC;
     - повторная инициализация точек Lucas–Kanade внутри восстановленной ROI;
   - визуализация результатов (Bounding Box, ключевые точки, статус трекинга).
7. Подсчёт статистики:
   - количество обработанных кадров;
   - количество успешно отслеженных кадров;
   - число потерь трекинга;
   - количество попыток и успешных восстановлений.


---

## Параметры реализации

- **Детектор ключевых точек:** Первичные точки LK: goodFeaturesToTrack; AKAZE используется для восстановления трекинга  
- **Максимальное число точек LK:** 500  
- **Порог качества для LK:** 0.01  
- **Минимальное расстояние между точками:** 7 px  
- **Размер блока для LK:** 7×7  
- **Lucas–Kanade:** `winSize=(21,21)`, `maxLevel=3`, `criteria=(30, 0.01)`  
- **Минимум inliers для LK:** 15  
- **Минимум inliers для AKAZE:** 8  

---

## Экспериментальная часть

### Используемые данные

- Тестовые видеоролики из папки `test_videos/`;
- Видеозапись с объектом схожей структуры, сделанная самостоятельно.

---

### Наблюдения

- Алгоритм устойчив при умеренном движении объекта;
- Bounding Box корректно показывает область объекта при размытии;
- Гомография обеспечивает более точное позиционирование при хорошем качестве видео;
- Потеря трекинга возможна при резких движениях или сильных окклюзиях;
- Восстановление трекинга через AKAZE эффективно при частичной потере точек.

---

## Выводы

- Реализован прототип системы трекинга объекта на видео с использованием AKAZE и Lucas–Kanade;
- Алгоритм корректно отслеживает объекты с выраженной текстурой;
- Демонстрируется устойчивость к масштабированию и поворотам;
- Позволяет визуально оценивать качество трекинга;
- Ограничения метода связаны с качеством видео и допущениями оптического потока.

---



